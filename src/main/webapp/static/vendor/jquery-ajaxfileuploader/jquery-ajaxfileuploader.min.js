/*! AjaxFileUploaderV2.1 modified */
jQuery.extend({createUploadIframe:function(e,t){var n="jUploadFrame"+e,r='<iframe id="'+n+'" name="'+n+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&(typeof t=="boolean"?r+=' src="javascript:false"':typeof t=="string"&&(r+=' src="'+t+'"')),r+="></iframe>",jQuery(r).appendTo(document.body),jQuery("#"+n).get(0)},createUploadForm:function(e,t,n,r){var i="jUploadForm"+e,s="jUploadFile"+e,o=jQuery('<form action="" method="POST" name="'+i+'" id="'+i+'" enctype="multipart/form-data"></form>');if(n)if(Object.prototype.toString.call(n)==="[object Array]")for(var u in n)jQuery('<input type="hidden" name="'+n[u].name+'" value="'+n[u].value+'" />').appendTo(o);else for(var u in n)jQuery('<input type="hidden" name="'+u+'" value="'+n[u]+'" />').appendTo(o);r&&jQuery('<input type="hidden" name="callback" />').val("<script type='text/javascript'>try{document.domain=window.location.hostname.split('.').reverse().slice(0,2).reverse().join('.');}catch(e){}</script>").appendTo(o);var a=jQuery("#"+t),f=jQuery(a).clone();return jQuery(a).attr("id",s),jQuery(a).before(f),jQuery(a).appendTo(o),jQuery(o).css("position","absolute"),jQuery(o).css("top","-1200px"),jQuery(o).css("left","-1200px"),jQuery(o).appendTo("body"),o},ajaxFileUpload:function(e){var t=function(e,t,n,r){e.error&&e.error(t,n,r),e.global&&jQuery.event.trigger("ajaxError",[t,e,r])};e=jQuery.extend({},jQuery.ajaxSettings,e);var n=(new Date).getTime(),r=jQuery.createUploadForm(n,e.fileElementId,typeof e.data=="undefined"?!1:e.data,e.crossDomain),i=jQuery.createUploadIframe(n,e.secureuri),s="jUploadFrame"+n,o="jUploadForm"+n;e.global&&!(jQuery.active++)&&jQuery.event.trigger("ajaxStart");var u=!1,a={};e.global&&jQuery.event.trigger("ajaxSend",[a,e]);var f=function(n){var i=document.getElementById(s),o=function(){try{i.contentWindow?(a.responseText=i.contentWindow.document.body?i.contentWindow.document.body.innerHTML:null,a.responseXML=i.contentWindow.document.XMLDocument?i.contentWindow.document.XMLDocument:i.contentWindow.document):i.contentDocument&&(a.responseText=i.contentDocument.document.body?i.contentDocument.document.body.innerHTML:null,a.responseXML=i.contentDocument.document.XMLDocument?i.contentDocument.document.XMLDocument:i.contentDocument.document)}catch(s){t(e,a,null,s)}if(a||n=="timeout"){u=!0;var o;try{o=n!="timeout"?"success":"error";if(o!="error"){var f=jQuery.uploadHttpData(a,e.dataType);e.success&&e.success(f,o),e.global&&jQuery.event.trigger("ajaxSuccess",[a,e])}else t(e,a,o)}catch(s){o="error",t(e,a,o,s)}e.global&&jQuery.event.trigger("ajaxComplete",[a,e]),e.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),e.complete&&e.complete(a,o),jQuery(i).unbind(),setTimeout(function(){try{jQuery(i).remove(),jQuery(r).remove()}catch(n){t(e,a,null,n)}},100),a=null}};if(e.crossDomain)var f=window.setTimeout(function(){try{o()}catch(e){}},1e3);else o()};e.timeout>0&&setTimeout(function(){u||f("timeout")},e.timeout);try{var r=jQuery("#"+o);jQuery(r).attr("action",e.url),jQuery(r).attr("method","POST"),jQuery(r).attr("target",s),r.encoding?jQuery(r).attr("encoding","multipart/form-data"):jQuery(r).attr("enctype","multipart/form-data"),jQuery(r).submit()}catch(l){t(e,a,null,l)}return jQuery("#"+s).load(f),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data=type=="xml"||data?r.responseXML:r.responseText,data=data.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/igm,"").replace(/<[^>]+>/g,""),type=="script"&&jQuery.globalEval(data),type=="json"&&eval("data = "+data),type=="html"&&jQuery("<div>").html(data).evalScripts(),data}});
